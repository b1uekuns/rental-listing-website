<%- include('partials/header') %>

<main>
  <!-- Hiá»ƒn thá»‹ thÃ´ng bÃ¡o lá»—i/thÃ nh cÃ´ng -->
  <% if (locals.error) { %>
  <div
    class="alert alert-danger"
    style="margin: 80px auto 0 auto; max-width: 1200px"
  >
    <%= locals.error %>
  </div>
  <% } %> <% if (locals.success) { %>
  <div
    class="alert alert-success"
    style="margin: 80px auto 0 auto; max-width: 1200px"
  >
    <%= locals.success %>
  </div>
  <% } %>

  <section class="hero">
    <div class="container">
      <h1>TÃ¬m Kiáº¿m NhÃ  Cho ThuÃª Táº¡i HÃ  Ná»™i</h1>
      <p class="hero-description">
        HÃ ng nghÃ¬n cÄƒn há»™, phÃ²ng trá» cháº¥t lÆ°á»£ng Ä‘ang chá» báº¡n
      </p>

      <form action="/listings/search" method="GET" class="search-form">
        <div class="form-group">
          <select name="district">
            <option value="">Chá»n quáº­n/huyá»‡n</option>
            <% districts.forEach(district => { %>
            <option value="<%= district.id %>"><%= district.name %></option>
            <% }); %>
          </select>
        </div>
        <div class="form-group">
          <select name="property_type">
            <option value="">Loáº¡i hÃ¬nh</option>
            <option value="phong_tro">PhÃ²ng trá»</option>
            <option value="nha_nguyen_can">NhÃ  nguyÃªn cÄƒn</option>
            <option value="can_ho">CÄƒn há»™</option>
            <option value="o_ghep">á» ghÃ©p</option>
          </select>
        </div>
        <div class="form-group">
          <select name="price_range">
            <option value="">Khoáº£ng giÃ¡</option>
            <option value="0-2000000">DÆ°á»›i 2 triá»‡u</option>
            <option value="2000000-5000000">2 - 5 triá»‡u</option>
            <option value="5000000-10000000">5 - 10 triá»‡u</option>
            <option value="10000000-20000000">10 - 20 triá»‡u</option>
            <option value="20000000-999999999">TrÃªn 20 triá»‡u</option>
          </select>
        </div>
        <div class="form-group">
          <input
            type="number"
            name="area"
            placeholder="Diá»‡n tÃ­ch (mÂ²)"
            min="0"
          />
        </div>
        <button type="submit">TÃ¬m kiáº¿m</button>
      </form>
    </div>
  </section>

  <section class="featured-areas">
    <div class="container">
      <h2>Khu Vá»±c Ná»•i Báº­t</h2>
      <div class="areas-grid">
        <div class="area-card">
          <img src="/images/cau-giay.jpg" alt="Cáº§u Giáº¥y" />
          <div class="area-info">
            <h3>Cáº§u Giáº¥y</h3>
            <p>Khu vá»±c sÃ´i Ä‘á»™ng, gáº§n cÃ¡c trÆ°á»ng Ä‘áº¡i há»c</p>
            <a href="/listings?district=2" class="btn">Xem tin</a>
          </div>
        </div>
        <div class="area-card">
          <img src="/images/dong-da.jpg" alt="Äá»‘ng Äa" />
          <div class="area-info">
            <h3>Äá»‘ng Äa</h3>
            <p>Trung tÃ¢m vÄƒn hÃ³a, áº©m thá»±c</p>
            <a href="/listings?district=3" class="btn">Xem tin</a>
          </div>
        </div>
        <div class="area-card">
          <img src="/images/tay-ho.jpg" alt="TÃ¢y Há»“" />
          <div class="area-info">
            <h3>TÃ¢y Há»“</h3>
            <p>Khu vá»±c yÃªn tÄ©nh, view Ä‘áº¹p</p>
            <a href="/listings?district=8" class="btn">Xem tin</a>
          </div>
        </div>
      </div>
    </div>
  </section>

  <section class="featured-listings">
    <div class="container">
      <h2>Lá»°A CHá»ŒN CHá»– á» HOT</h2>
      <div class="hot-listings-grid">
        <% listings.forEach((listing) => { %> <% let images = []; if
        (Array.isArray(listing.images_urls)) { images = listing.images_urls; }
        else { try { images = JSON.parse(listing.images_urls || '[]'); }
        catch(e) { images = []; } } %>
        <div class="hot-listing-card">
          <div class="listing-image">
            <img
              src="<%= images[0] || '/images/no-image.png' %>"
              alt="<%= listing.title %>"
            />
          </div>
          <div class="listing-content">
            <h3 class="listing-title">
              <a href="/listings/<%= listing.id %>"><%= listing.title %></a>
            </h3>
            <div class="price-rating">
              <div class="price">
                <%= Math.round(listing.price).toLocaleString('vi-VN') %> VNÄ/thÃ¡ng
              </div>
              <div class="view-count">
                ğŸ‘ï¸ <%= listing.view_count || 0 %>
              </div>
            </div>
            <div class="property-details">
              <span class="property-type">
                <% if (listing.property_type === 'phong_tro') { %>PhÃ²ng trá»<% }
                else if (listing.property_type === 'nha_nguyen_can') { %>NhÃ 
                nguyÃªn cÄƒn<% } else if (listing.property_type === 'can_ho') {
                %>CÄƒn há»™<% } else if (listing.property_type === 'o_ghep') { %>á»
                ghÃ©p<% } else { %><%= listing.property_type %><% } %>
              </span>
              <span class="area"><%= listing.area %>mÂ²</span>
            </div>
            <div class="location">
              <span class="location-icon">ğŸ“</span>
              <span><%= listing.district_name %></span>
            </div>
          </div>
        </div>
        <% }); %>
      </div>
    </div>
  </section>

  <!-- Why Choose Us -->
  <section class="why-choose-us">
    <div class="container">
      <h2>Táº¡i Sao Chá»n ChÃºng TÃ´i</h2>
      <div class="features-grid">
        <div class="feature-card">
          <div class="feature-icon">ğŸ”</div>
          <h3>TÃ¬m Kiáº¿m Dá»… DÃ ng</h3>
          <p>Bá»™ lá»c thÃ´ng minh giÃºp báº¡n nhanh chÃ³ng tÃ¬m Ä‘Æ°á»£c nhÃ  phÃ¹ há»£p</p>
        </div>
        <div class="feature-card">
          <div class="feature-icon">âœ“</div>
          <h3>ThÃ´ng Tin XÃ¡c Thá»±c</h3>
          <p>Tin Ä‘Äƒng Ä‘Æ°á»£c kiá»ƒm duyá»‡t, Ä‘áº£m báº£o Ä‘á»™ tin cáº­y</p>
        </div>
        <div class="feature-card">
          <div class="feature-icon">ğŸ’¬</div>
          <h3>Há»— Trá»£ 24/7</h3>
          <p>Äá»™i ngÅ© tÆ° váº¥n nhiá»‡t tÃ¬nh, chuyÃªn nghiá»‡p</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Call to Action -->
  <section class="cta">
    <div class="container">
      <h2>Báº¡n Äang TÃ¬m NhÃ  Cho ThuÃª?</h2>
      <p>ÄÄƒng tin miá»…n phÃ­ ngay hÃ´m nay Ä‘á»ƒ tiáº¿p cáº­n hÃ ng nghÃ¬n ngÆ°á»i dÃ¹ng</p>
      <div class="cta-buttons">
        <a href="/listings/create" class="btn btn-primary">ÄÄƒng tin miá»…n phÃ­</a>
        <a href="/listings" class="btn btn-secondary">TÃ¬m nhÃ  ngay</a>
      </div>
    </div>
  </section>
</main>

<!-- Popup quáº£ng cÃ¡o -->
<% if (popupListing) { %> <% let popupImages = []; if
(Array.isArray(popupListing.images_urls)) { popupImages =
popupListing.images_urls; } else { try { popupImages =
JSON.parse(popupListing.images_urls || '[]'); } catch(e) { popupImages = []; } }
%>
<div id="adPopup" class="ad-popup">
  <div class="ad-popup-content">
    <button class="ad-popup-close" onclick="closeAdPopup()">&times;</button>
    <div class="ad-content">
      <h3>ğŸ  Tin ÄÄƒng Ná»•i Báº­t!</h3>
      <img
        src="<%= popupImages[0] || '/images/no-image.png' %>"
        alt="<%= popupListing.title %>"
        style="
          width: 100%;
          height: 200px;
          object-fit: cover;
          border-radius: 8px;
          margin: 1rem 0;
        "
      />
      <h4><%= popupListing.title %></h4>
      <p class="ad-price">
        Chá»‰ tá»«
        <strong
          ><%= Math.round(popupListing.price).toLocaleString('vi-VN') %>
          VNÄ/thÃ¡ng</strong
        >
      </p>
      <p>
        âœ… Diá»‡n tÃ­ch: <%= popupListing.area %>mÂ²<br />
        âœ… Loáº¡i hÃ¬nh: <% if (popupListing.property_type === 'phong_tro') {
        %>PhÃ²ng trá»<% } else if (popupListing.property_type ===
        'nha_nguyen_can') { %>NhÃ  nguyÃªn cÄƒn<% } else if
        (popupListing.property_type === 'can_ho') { %>CÄƒn há»™<% } else if
        (popupListing.property_type === 'o_ghep') { %>á» ghÃ©p<% } else { %><%=
        popupListing.property_type %><% } %><br />
        âœ… Khu vá»±c: <%= popupListing.district_name %><br />
        âœ… LÆ°á»£t xem: <%= popupListing.view_count || 0 %>
      </p>
      <a
        href="/listings/<%= popupListing.id %>"
        class="btn btn-primary"
        style="
          width: 100%;
          text-align: center;
          margin-top: 1rem;
          font-size: 1rem !important;
        "
        >Xem chi tiáº¿t ngay</a
      >
    </div>
  </div>
</div>
<% } %>

<script>
  // Popup quáº£ng cÃ¡o
  function showAdPopup() {
    // Kiá»ƒm tra cookie xem Ä‘Ã£ Ä‘Ã³ng popup chÆ°a
    if (document.cookie.indexOf("adPopupClosed=true") === -1) {
      document.getElementById("adPopup").style.display = "flex";
    }
  }

  function closeAdPopup() {
    document.getElementById("adPopup").style.display = "none";
    // Set cookie Ä‘á»ƒ nhá»› Ä‘Ã£ Ä‘Ã³ng popup (expires sau 1 ngÃ y)
    const expires = new Date();
    expires.setTime(expires.getTime() + 24 * 60 * 60 * 1000);
    document.cookie =
      "adPopupClosed=true; expires=" + expires.toUTCString() + "; path=/";
  }

  // Hiá»ƒn thá»‹ popup sau 1 phÃºt (60000ms)
  setTimeout(showAdPopup, 60000);

  // ÄÃ³ng popup khi click bÃªn ngoÃ i
  document.getElementById("adPopup").addEventListener("click", function (e) {
    if (e.target === this) {
      closeAdPopup();
    }
  });
</script>

<%- include('partials/footer') %>
